(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{270:function(e,t,n){"use strict";var o=n(14),r=n(15),a=n(17),i=n(19),c=n(0),s=n.n(c),l=n(5),u=n(11),p=n(6),f=n(2),d=n.n(f),h=n(111);function v(e){var t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}function b(e){var t=new XMLHttpRequest;e.onProgress&&t.upload&&(t.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.onProgress(t)});var n=new FormData;e.data&&Object.keys(e.data).forEach((function(t){var o=e.data[t];Array.isArray(o)?o.forEach((function(e){n.append("".concat(t,"[]"),e)})):n.append(t,e.data[t])})),e.file instanceof Blob?n.append(e.filename,e.file,e.file.name):n.append(e.filename,e.file),t.onerror=function(t){e.onError(t)},t.onload=function(){return t.status<200||t.status>=300?e.onError(function(e,t){var n="cannot ".concat(e.method," ").concat(e.action," ").concat(t.status,"'"),o=new Error(n);return o.status=t.status,o.method=e.method,o.url=e.action,o}(e,t),v(t)):e.onSuccess(v(t),t)},t.open(e.method,e.action,!0),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);var o=e.headers||{};return null!==o["X-Requested-With"]&&t.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(o).forEach((function(e){null!==o[e]&&t.setRequestHeader(e,o[e])})),t.send(n),{abort:function(){t.abort()}}}var y=+new Date,m=0;function k(){return"rc-upload-".concat(y,"-").concat(++m)}var w=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),o=e.name||"",r=e.type||"",a=r.replace(/\/.*$/,"");return n.some((function(e){var t,n,i=e.trim();return"."===i.charAt(0)?(t=o.toLowerCase(),n=i.toLowerCase(),-1!==t.indexOf(n,t.length-n.length)):/\/\*$/.test(i)?a===i.replace(/\/.*$/,""):r===i}))}return!0};var O=function(e,t,n){var o=function e(o,r){o.path=r||"",o.isFile?o.file((function(e){n(e)&&(o.fullPath&&!e.webkitRelativePath&&(Object.defineProperties(e,{webkitRelativePath:{writable:!0}}),e.webkitRelativePath=o.fullPath.replace(/^\//,""),Object.defineProperties(e,{webkitRelativePath:{writable:!1}})),t([e]))})):o.isDirectory&&function(e,t){var n=e.createReader(),o=[];!function e(){n.readEntries((function(n){var r=Array.prototype.slice.apply(n);o=o.concat(r),r.length?e():t(o)}))}()}(o,(function(t){t.forEach((function(t){e(t,"".concat(r).concat(o.name,"/"))}))}))};e.forEach((function(e){o(e.webkitGetAsEntry())}))},j=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.apply(this,arguments)).state={uid:k()},e.reqs={},e.onChange=function(t){var n=t.target.files;e.uploadFiles(n),e.reset()},e.onClick=function(t){var n=e.fileInput;if(n){var o=e.props,r=o.children,a=o.onClick;if(r&&"button"===r.type){var i=n.parentNode;i.focus(),i.querySelector("button").blur()}n.click(),a&&a(t)}},e.onKeyDown=function(t){"Enter"===t.key&&e.onClick(t)},e.onFileDrop=function(t){var n=e.props.multiple;if(t.preventDefault(),"dragover"!==t.type)if(e.props.directory)O(Array.prototype.slice.call(t.dataTransfer.items),e.uploadFiles,(function(t){return w(t,e.props.accept)}));else{var o=Array.prototype.slice.call(t.dataTransfer.files).filter((function(t){return w(t,e.props.accept)}));!1===n&&(o=o.slice(0,1)),e.uploadFiles(o)}},e.uploadFiles=function(t){var n=Array.prototype.slice.call(t);n.map((function(e){return e.uid=k(),e})).forEach((function(t){e.upload(t,n)}))},e.saveFileInput=function(t){e.fileInput=t},e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"upload",value:function(e,t){var n=this,o=this.props;if(o.beforeUpload){var r=o.beforeUpload(e,t);r&&"boolean"!=typeof r&&r.then?r.then((function(t){var o=Object.prototype.toString.call(t);"[object File]"!==o&&"[object Blob]"!==o?n.post(e):n.post(t)})).catch((function(e){console.log(e)})):!1!==r&&Promise.resolve().then((function(){n.post(e)}))}else Promise.resolve().then((function(){n.post(e)}))}},{key:"post",value:function(e){var t=this;if(this._isMounted){var n=this.props,o=n.onStart,r=n.onProgress,a=n.transformFile,i=void 0===a?function(e){return e}:a;new Promise((function(t){var o=n.action;return"function"==typeof o&&(o=o(e)),t(o)})).then((function(a){var c=e.uid,s=n.customRequest||b;Promise.resolve(i(e)).then((function(e){var t=n.data;return"function"==typeof t&&(t=t(e)),Promise.all([e,t])})).catch((function(e){console.error(e)})).then((function(i){var l=Object(p.a)(i,2),u=l[0],f=l[1],d={action:a,filename:n.name,data:f,file:u,headers:n.headers,withCredentials:n.withCredentials,method:n.method||"post",onProgress:r?function(t){r(t,e)}:null,onSuccess:function(o,r){delete t.reqs[c],n.onSuccess(o,e,r)},onError:function(o,r){delete t.reqs[c],n.onError(o,r,e)}};o(e),t.reqs[c]=s(d)}))}))}}},{key:"reset",value:function(){this.setState({uid:k()})}},{key:"abort",value:function(e){var t=this.reqs;if(e){var n=e.uid?e.uid:e;t[n]&&t[n].abort&&t[n].abort(),delete t[n]}else Object.keys(t).forEach((function(e){t[e]&&t[e].abort&&t[e].abort(),delete t[e]}))}},{key:"render",value:function(){var e,t=this.props,n=t.component,o=t.prefixCls,r=t.className,a=t.disabled,i=t.id,c=t.style,p=t.multiple,f=t.accept,v=t.children,b=t.directory,y=t.openFileDialogOnClick,m=t.onMouseEnter,k=t.onMouseLeave,w=Object(u.a)(t,["component","prefixCls","className","disabled","id","style","multiple","accept","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave"]),O=d()((e={},Object(l.a)(e,o,!0),Object(l.a)(e,"".concat(o,"-disabled"),a),Object(l.a)(e,r,r),e)),j=b?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},C=a?{}:{onClick:y?this.onClick:function(){},onKeyDown:y?this.onKeyDown:function(){},onMouseEnter:m,onMouseLeave:k,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:"0"};return s.a.createElement(n,Object.assign({},C,{className:O,role:"button",style:c}),s.a.createElement("input",Object.assign({},Object(h.a)(w,{aria:!0,data:!0}),{id:i,type:"file",ref:this.saveFileInput,onClick:function(e){return e.stopPropagation()},key:this.state.uid,style:{display:"none"},accept:f},j,{multiple:p,onChange:this.onChange})),v)}}]),n}(c.Component);function C(){}var g=function(e){Object(a.a)(n,e);var t=Object(i.a)(n);function n(){var e;return Object(o.a)(this,n),(e=t.apply(this,arguments)).saveUploader=function(t){e.uploader=t},e}return Object(r.a)(n,[{key:"abort",value:function(e){this.uploader.abort(e)}},{key:"render",value:function(){return s.a.createElement(j,Object.assign({},this.props,{ref:this.saveUploader}))}}]),n}(c.Component);g.defaultProps={component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:C,onError:C,onSuccess:C,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0};var E=g;t.a=E}}]);